---
title: "Word Cloud"
author: "Schaffer"
date: "March 13, 2017"
output: html_document
---

## Word cloud
Below is a word cloud derived from a sample of 50 recent tweets that include the word "Trump" taken from the twitter archive.  I restricted the search to tweets posted from November 8, 2016, election day, to the present and from within 10 miles of the American University campus.

```{r thewordcloud, results='hide', echo=FALSE, message=FALSE}
##### EDIT SEARCH PARAMETERS BELOW
search_term <- "Trump"  # For two terms use e.g. "compassion+love"
                             # For hashtags use e.g. "#compassion"
language <- "en"
sample_size <- 1000
since <- '2017-03-20'  # Election Day
until <- '2017-03-21'  # INSERT Until Date, not used here
##### EDIT SEARCH PARAMETERS ABOVE

# NEXT 4 LINES LOAD LIBRARIES OF FUNCTIONS
library(twitteR)
library(tm)
library(wordcloud)
library(RColorBrewer)
library(ROAuth)

# NEXT LINE AUTHENTICATES SESSION WITH TWITTER
source("my_access.R")

####### EDIT THE NEXT LINE TO SPECIFY SEARCH
tweets_raw = searchTwitter(search_term, 
                           n=sample_size,
                           since=since,
                           until=until,
                           lang=language)
####### EDIT THE PREVIOUS LINE TO SPECIFY SEARCH

# NEXT TWO LINES REMOVES META-DATA THEN CONVERTS DATA TO A NEEDED FORMAT
tweets_text = sapply(tweets_raw, function(x) x$getText())
tweets_corpus = Corpus(VectorSource(tweets_text))

# NEXT LINE REMOVES SPECIAL CHARACTERS AVAILABLE IN OTHER LANGUAGES
tweets_transformed1 <- tm_map(tweets_corpus, 
                               content_transformer(function(x) iconv(x,
                               to="UTF-8")))
# NEXT LINE CONVERTS EVERYTHING TO LOWER CASE
tweets_transformed2 <- tm_map(tweets_transformed1,
                              content_transformer(tolower))
# NEXT LINE REMOVES PUNCTUATION
tweets_transformed3 <- tm_map(tweets_transformed2,
                              removePunctuation)
# NEXT LINE REMOVES "STOPWORDS" LIKE "THE", "AN", "IS", "BE", ETC.
tweets_transformed4 <- tm_map(tweets_transformed3,
                              function(x) removeWords(x,stopwords()))
# Replace blank space (“rt”)
tweets_transformed5 <- gsub("rt", "", tweets_transformed4)

# Replace @UserName
tweets_transformed6 <- gsub("@\\w+", "", tweets_transformed5)

# Remove links
tweets_transformed7 <- gsub("http\\w+", "", tweets_transformed6)

# Remove tabs
tweets_transformed8 <- gsub("[ |\t]{2,}", "", tweets_transformed7)

# Remove blank spaces at the beginning
tweets_transformed9 <- gsub("^ ", "", tweets_transformed8)

# Remove blank spaces at the end
tweets_transformed10 <- gsub(" $", "", tweets_transformed9)

###### EDIT NEXT LINE TO SPECIFY DRAWING OF WORD CLOUD
wordcloud(tweets_transformed10, min.freq = 5, scale=c(7,0.5),colors=brewer.pal(8, "Dark2"),  random.color= TRUE, random.order = FALSE, max.words = 100)
```

## Code

Attached below is the code used to generate this document.  It contains text, markup, and code for connecting with twitter, downloading a sample of tweets, and creating the word cloud.